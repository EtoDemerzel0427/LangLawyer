#!/usr/bin/env bash
set -euo pipefail

if ! command -v clang-format >/dev/null 2>&1; then
  echo "clang-format is required but not found in PATH. Please install it." >&2
  exit 1
fi

changed_files="$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(c|cc|cxx|cpp|hpp|h|hh|ipp)$' || true)"

if [ -z "${changed_files}" ]; then
  exit 0
fi

for file in ${changed_files}; do
  if [ -f "${file}" ]; then
    clang-format -style=file -i "${file}"
    git add "${file}"
  fi
done

